# 포팅 매뉴얼

- [포팅 매뉴얼](#포팅-매뉴얼)
  - [1. 테스트 환경](#1-테스트-환경)
  - [2. Requirements](#2-requirements)
  - [3. 설정 및 빌드](#3-설정-및-빌드)
    - [3-1. 백엔드 서버 설정](#3-1-백엔드-서버-설정)
      - [루트 .env 파일](#루트-env-파일)
      - [SSL 설정](#ssl-설정)
      - [빌드 및 서버 실행](#빌드-및-서버-실행)
    - [3-2. 하드웨어 설정](#3-2-하드웨어-설정)

## 1. 테스트 환경

- AWS EC2
- Ubuntu 20.04 LTS
- Raspberry Pi 4
- USB Webcam
- USB Mic
- LCD Display (1024x600)

## 2. Requirements

- Docker >= 20.10.0
- Mosquitto >= 2.0.15
  - with TLS encryption, port 8883
- RPi4
  - Python == 3.7
  - OpenCV ...
  - NodeJS ...
  - 더 써줘

## 3. 설정 및 빌드

### 3-1. 백엔드 서버 설정

#### 루트 .env 파일

빌드 및 운영에 관여하는 모든 시크릿 정보가 담긴 파일

- .env.template를 .env로 복사한 후 내용을 작성
  - `SERVICE_HOST`: 서비스의 도메인 주소 (ie. j7a704.p.ssafy.io)
  - `MYSQL_###`: MariaDB 관련 변수
    - `MYSQL_HOST`: 빌트인 MariaDB를 사용하는 경우 기본값 db를 유지해야 함 (docker-compose.yml에 정의됨)
  - `OAUTH2_###`: 소셜로그인을 위한 ID, SECRET
    - [Google](https://console.cloud.google.com/)
    - [Kakao](https://developers.kakao.com/)
  - `LOGIN_###`: 로그인 후 리다이렉트 될 주소
    - `LOGIN_SCHEME`: http 또는 https
    - `LOGIN_HOST`: {SERVICE_HOST}와 동일하게 설정
  - `BROKER_URL`, `BASE_TOPIC`: MQTT 관련 설정
    - `BROKER_URL`: MQTT 서버의 URL (TLS를 사용할 경우 ssl://로 시작)
    - `BASE_TOPIC`: 기본적으로 사용할 MQTT Topic

#### SSL 설정

 - docker-compose.yml 수정
   - `nginx:` 블록의 `volumes:` {cert_path}:/etc/letsencrypt 형태로 수정
 - nginx/nginx.conf.template 수정
   - `ssl_certificate` 및 `ssl_certificate_key`를 알맞게 설정 (기본값: `/etc/letsencrypt/live/${SERVICE_HOST}/...`)


#### 빌드 및 서버 실행

```bash
$ cd {PROJECT_ROOT}
$ docker compose up -d --build
```

### 3-2. 하드웨어 설정

써줘
